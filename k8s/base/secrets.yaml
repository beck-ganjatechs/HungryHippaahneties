# HungryHippaahneties - Secrets Management for HIPAA Compliance
# Based on OWASP Secrets Management Cheat Sheet
# NOTE: In production, use external secrets management (Vault, AWS Secrets Manager, etc.)
# These are PLACEHOLDER values - NEVER commit real secrets to git!

apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: hungryhippaahneties
  labels:
    app: postgresql
    tier: backend
    compliance: hipaa
  annotations:
    description: "PostgreSQL database credentials"
    rotation-schedule: "90 days"
type: Opaque
stringData:
  # PLACEHOLDER - Replace with actual secrets via CI/CD or external secrets operator
  POSTGRES_USER: "hipaa_app_user"
  POSTGRES_PASSWORD: "CHANGE_ME_USE_EXTERNAL_SECRETS_MANAGER"
  POSTGRES_DB: "hungryhippaahneties_db"
  POSTGRES_HOST: "postgresql-service"
  POSTGRES_PORT: "5432"
  # Connection string with SSL required
  DATABASE_URL: "postgresql://hipaa_app_user:CHANGE_ME@postgresql-service:5432/hungryhippaahneties_db?sslmode=require"
---
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: hungryhippaahneties
  labels:
    app: redis
    tier: backend
    compliance: hipaa
  annotations:
    description: "Redis cache credentials"
    rotation-schedule: "90 days"
type: Opaque
stringData:
  # PLACEHOLDER - Replace with actual secrets
  REDIS_PASSWORD: "CHANGE_ME_USE_EXTERNAL_SECRETS_MANAGER"
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6380"
  REDIS_TLS: "true"
  REDIS_URL: "rediss://:CHANGE_ME@redis-service:6380/0"
---
apiVersion: v1
kind: Secret
metadata:
  name: api-secrets
  namespace: hungryhippaahneties
  labels:
    app: api
    tier: middleware
    compliance: hipaa
  annotations:
    description: "API service secrets"
    rotation-schedule: "30 days"
type: Opaque
stringData:
  # JWT secrets - use RS256 with key pair in production
  JWT_SECRET: "CHANGE_ME_USE_256_BIT_RANDOM_KEY"
  JWT_EXPIRY: "900"  # 15 minutes
  JWT_REFRESH_EXPIRY: "86400"  # 24 hours
  # API encryption key for sensitive data
  ENCRYPTION_KEY: "CHANGE_ME_USE_AES_256_KEY"
  # Session fingerprint secret
  SESSION_SECRET: "CHANGE_ME_USE_RANDOM_SECRET"
---
apiVersion: v1
kind: Secret
metadata:
  name: tls-certificates
  namespace: hungryhippaahneties
  labels:
    compliance: hipaa
  annotations:
    description: "TLS certificates for internal communication"
    cert-manager.io/issuer: "internal-ca"
type: kubernetes.io/tls
stringData:
  # PLACEHOLDER - In production, use cert-manager or external CA
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    PLACEHOLDER_CERTIFICATE
    Replace with actual certificate from cert-manager
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN PRIVATE KEY-----
    PLACEHOLDER_PRIVATE_KEY
    Replace with actual private key
    -----END PRIVATE KEY-----
  ca.crt: |
    -----BEGIN CERTIFICATE-----
    PLACEHOLDER_CA_CERTIFICATE
    Replace with CA certificate
    -----END CERTIFICATE-----
---
# ===========================================
# EXTERNAL SECRETS OPERATOR CONFIGURATION
# Uncomment and configure for production use
# ===========================================
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: db-credentials-external
#   namespace: hungryhippaahneties
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: vault-backend
#     kind: ClusterSecretStore
#   target:
#     name: db-credentials
#     creationPolicy: Owner
#   data:
#     - secretKey: POSTGRES_USER
#       remoteRef:
#         key: hungryhippaahneties/database
#         property: username
#     - secretKey: POSTGRES_PASSWORD
#       remoteRef:
#         key: hungryhippaahneties/database
#         property: password
---
# ===========================================
# SEALED SECRETS (Alternative for GitOps)
# ===========================================
# apiVersion: bitnami.com/v1alpha1
# kind: SealedSecret
# metadata:
#   name: db-credentials-sealed
#   namespace: hungryhippaahneties
# spec:
#   encryptedData:
#     POSTGRES_PASSWORD: AgByzN...encrypted...
---
# ===========================================
# SECRET ENCRYPTION AT REST CONFIG
# Apply to kube-apiserver for etcd encryption
# ===========================================
# apiVersion: apiserver.config.k8s.io/v1
# kind: EncryptionConfiguration
# resources:
#   - resources:
#       - secrets
#     providers:
#       - aescbc:
#           keys:
#             - name: key1
#               secret: <base64-encoded-32-byte-key>
#       - identity: {}
